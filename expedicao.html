<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>ExpediÃ§Ã£o</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
<h2>ðŸšš ExpediÃ§Ã£o</h2>

<label>
  SKU<br>
  <input id="sku">
</label>
<br><br>

<label>
  Tipo de Unidade<br>
  <select id="tipo">
    <option value="PL2">PL2</option>
    <option value="PBR">PBR</option>
    <option value="FARDO">Fardo</option>
  </select>
</label>
<br><br>

<label>
  Quantidade<br>
  <input id="qtd" type="number" min="1">
</label>
<br><br>

<button onclick="saida()">Confirmar SaÃ­da</button>

<p id="msg"></p>

<script>
const supabase = supabase.createClient(
  'URL',
  'KEY'
)

const skuInput  = document.getElementById('sku')
const tipoInput = document.getElementById('tipo')
const qtdInput  = document.getElementById('qtd')
const msg       = document.getElementById('msg')

async function saida() {
  const sku  = skuInput.value.trim()
  const tipo = tipoInput.value
  const qtd  = Number(qtdInput.value)

  if (!sku || !qtd || qtd <= 0) {
    msg.innerText = 'Preencha todos os campos corretamente'
    return
  }

  const { error } = await supabase
    .from('movimentacoes')
    .insert({
      sku: sku,
      tipo_movimentacao: 'SAIDA',
      unidade: tipo,        // PL2 | PBR | FARDO
      quantidade: qtd,
      data: new Date()
    })

  if (error) {
    msg.innerText = 'Erro ao registrar saÃ­da'
    console.error(error)
  } else {
    msg.innerText = `SaÃ­da registrada: ${qtd} ${tipo}`
    skuInput.value = ''
    qtdInput.value = ''
  }
}
</script>

</body>
</html>
