<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>ExpediÃ§Ã£o</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.card {
  background: #fff;
  padding: 20px;
  max-width: 400px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,.15);
}
input, select, button {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
}
button {
  background: #d32f2f;
  color: #fff;
  border: none;
  border-radius: 4px;
}
.sucesso { color: green; font-weight: bold; }
.erro { color: red; font-weight: bold; }
</style>
</head>

<body>

<h2>ðŸšš ExpediÃ§Ã£o</h2>

<div class="card">
  SKU
  <input id="sku">

  Tipo
  <select id="tipo">
    <option value="PL2">PL2</option>
    <option value="PBR">PBR</option>
    <option value="FARDO">Fardo</option>
  </select>

  Quantidade
  <input id="qtd" type="number" min="1">

  <button onclick="saida()">Confirmar SaÃ­da</button>
  <p id="msg"></p>
</div>

<script>
const supabase = window.supabase.createClient(
  'https://qfjghplxbtogshfjkawx.supabase.co',
  'sb_publishable_rIcKdaflOvJ0DLTJDcOrxA_bpTGG2hA',
  {
    auth: { persistSession: false }
  }
)

const skuInput  = document.getElementById('sku')
const tipoInput = document.getElementById('tipo')
const qtdInput  = document.getElementById('qtd')
const msg       = document.getElementById('msg')

async function saida() {
  msg.innerText = ''
  msg.className = ''

  try {
    const sku  = skuInput.value.trim()
    const tipo = tipoInput.value
    const qtd  = Number(qtdInput.value)

    if (!sku || qtd <= 0) {
      throw 'Preencha corretamente os campos'
    }

    const { error } = await supabase
      .from('movimentacoes')
      .insert({
        sku,
        tipo_movimentacao: 'SAIDA',
        unidade: tipo,
        quantidade: qtd
      })

    if (error) throw 'Erro ao registrar saÃ­da'

    msg.innerText = `âœ… SaÃ­da registrada: ${qtd} ${tipo}`
    msg.className = 'sucesso'
    skuInput.value = ''
    qtdInput.value = ''

  } catch (e) {
    msg.innerText = 'âŒ ' + e
    msg.className = 'erro'
  }
}
</script>

</body>
</html>
