<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Confer√™ncia de √Årea</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
.card {
  background: #fff;
  padding: 20px;
  max-width: 400px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,.15);
}
input, button {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
}
button {
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 4px;
}
.sucesso { color: green; font-weight: bold; }
.erro { color: red; font-weight: bold; }
</style>
</head>

<body>

<h2>üì¶ Confer√™ncia de √Årea</h2>

<div class="card">
  √Årea
  <input id="area" placeholder="Ex: A01">

  SKU
  <input id="sku">

  Quantidade
  <input id="qtd" type="number" min="0">

  <button onclick="confirmar()">Confirmar / Atualizar</button>
  <p id="msg"></p>
</div>

<script>
const supabase = window.supabase.createClient(
  'https://qfjghplxbtogshfjkawx.supabase.co',
  'sb_publishable_rIcKdaflOvJ0DLTJDcOrxA_bpTGG2hA',
  {
    auth: { persistSession: false }
  }
)

const msg = document.getElementById('msg')

async function confirmar() {
  msg.innerText = 'Processando...'
  msg.className = ''

  try {
    const area = document.getElementById('area').value.trim()
    const sku  = document.getElementById('sku').value.trim()
    const qtd  = Number(document.getElementById('qtd').value)

    if (!area || !sku || qtd < 0) {
      throw 'Preencha todos os campos corretamente'
    }

    const { data: existente } = await supabase
      .from('estoque')
      .select('id')
      .eq('area', area)
      .eq('sku', sku)
      .single()

    if (existente) {
      await supabase
        .from('estoque')
        .update({ quantidade: qtd })
        .eq('id', existente.id)

      msg.innerText = '‚úÖ Quantidade atualizada com sucesso'
    } else {
      await supabase
        .from('estoque')
        .insert({ area, sku, quantidade: qtd })

      msg.innerText = '‚úÖ Produto cadastrado na √°rea'
    }

    msg.className = 'sucesso'
  } catch (e) {
    msg.innerText = '‚ùå ' + e
    msg.className = 'erro'
  }
}
</script>

</body>
</html>
